<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>   
<h1 class="mb-4">üìä B√°o c√°o th·ªëng k√™</h1>

<!-- Cards t·ªïng quan -->
<div class="row mb-4">
  <div class="col-md-2">
    <div class="card text-center shadow-sm">
      <div class="card-body">
        <h5 class="card-title">T·ªïng s√°ch</h5>
        <p class="fs-4 fw-bold"><%= books.count %></p>
      </div>
    </div>
  </div>
  <div class="col-md-2">
    <div class="card text-center shadow-sm">
      <div class="card-body">
        <h5 class="card-title">T√°c gi·∫£</h5>
        <p class="fs-4 fw-bold"><%= authors.count %></p>
      </div>
    </div>
  </div>
  <div class="col-md-2">
    <div class="card text-center shadow-sm">
      <div class="card-body">
        <h5 class="card-title">Danh m·ª•c</h5>
        <p class="fs-4 fw-bold"><%= categories.count %></p>
      </div>
    </div>
  </div>
  <div class="col-md-2">
    <div class="card text-center shadow-sm">
      <div class="card-body">
        <h5 class="card-title">L∆∞·ª£t m∆∞·ª£n</h5>
        <p class="fs-4 fw-bold"><%= borrows.count %></p>
      </div>
    </div>
  </div>
  <div class="col-md-2">
    <div class="card text-center shadow-sm">
      <div class="card-body">
        <h5 class="card-title">T√†i kho·∫£n</h5>
        <p class="fs-4 fw-bold"><%= accounts.count %></p>
      </div>
    </div>
  </div>
  <div class="col-md-2">
    <div class="card text-center shadow-sm">
      <div class="card-body">
        <h5 class="card-title">Ti·ªÅn ph·∫°t</h5>
        <p class="fs-4 fw-bold text-danger"><%= fines.count %></p>
      </div>
    </div>
  </div>
</div>

<!-- Charts -->
<div class="row">
  <div class="col-md-6">
    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <h5 class="card-title">üìä M∆∞·ª£n/tr·∫£</h5>
        <canvas id="pieChart"></canvas>
      </div>
    </div>
  </div>

  <div class="col-md-6">
    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <h5 class="card-title">üìà So s√°nh t·ªïng quan</h5>
        <canvas id="barChart"></canvas>
      </div>
    </div>
  </div>
</div>



<script>
  document.addEventListener("DOMContentLoaded", function () {
    const totalBooks = <%- books.count %>;
    const totalAuthors = <%- authors.count %>;
    const totalCategories = <%- categories.count %>;
    const totalBorrows = <%- borrows.count %>;
    const totalAccounts = <%- accounts.count %>;
    const totalFines = <%- fines.count %>

    const borrowStatus = <%- JSON.stringify(borrowStatus.map(x => x[1])) %>;
    const borrows = <%- JSON.stringify(borrows.rows) %>;
    const dangYeuCauMon = borrows.filter(b => b.status === "<%= borrowStatusConstants.REQUESTED %>").length;
    const daDuyet = borrows.filter(b => b.status === "<%= borrowStatusConstants.APPROVED %>").length;
    const dangMuon = borrows.filter(b => b.status === "<%= borrowStatusConstants.BORROWED %>").length;
    const daTra = borrows.filter(b => b.status === "<%= borrowStatusConstants.RETURNED %>").length;
    const quaHan = borrows.filter(b => b.status === "<%= borrowStatusConstants.EXPIRED %>").length;
    const daHuy = borrows.filter(b => b.status === "<%= borrowStatusConstants.CANCELLED %>").length;
    const tuChoi = borrows.filter(b => b.status === 'T·ª´ ch·ªëi').length;
    const ctxPie = document.getElementById("pieChart");
    new Chart(ctxPie, {
      type: "pie",
      data: {
        labels: [...borrowStatus],
        datasets: [{
          data: [dangYeuCauMon, daDuyet, tuChoi, dangMuon, daTra, quaHan, daHuy],
          backgroundColor: [
            "#0d6efd", "#198754", "#dc3545", "#ffc107", "#6c757d", "#fd7e14", "#6610f2"
          ],
        }],
      },
    });
    
    const ctxBar = document.getElementById("barChart");
    new Chart(ctxBar, {
      type: "bar",
      data: {
        labels: ["S√°ch", "T√°c gi·∫£", "Danh m·ª•c", "M∆∞·ª£n", "T√†i kho·∫£n", "Ph·∫°t"],
        datasets: [{
          label: "S·ªë l∆∞·ª£ng",
          data: [totalBooks, totalAuthors, totalCategories, totalBorrows, totalAccounts, totalFines],
          backgroundColor: "#0d6efd",
        }],
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true } },
      },
    });
  });
</script>

